--- 
wordpress_id: 529
layout: post
title: !binary |
  YWN0c19hc19mZXJyZXQg5Lit5paH5ZWP6aGM77yIVmVyeVhEIOaQnOWwi+WK
  n+iDveS4iue3miHvvIk=

date: 2008-01-17 00:29:18 +08:00
wordpress_url: http://blog.xdite.net/?p=529
---
有鑑於 <a href="http://g.veryxd.net">VeryXD</a> 圖每天生太多，看不完，想回去翻又找不到。開始就有人問筆者，能不能加個 Tag 之類的。<br /><br />最後想想，其實最應該先寫的應該是搜尋吧，畢竟就算有 tag ...tag 一多還是照樣爆炸啊。所以這幾天就開始排自己功能實做的 schedule。<br /><br />不過呢，在 rails 上的搜尋問題曾經很困擾我。之前就是在作邪惡研究時手上有大批「中文」資料，可是因為 Rails 上的搜尋引擎 plugin<a href="http://www.railsenvy.com/2007/2/19/acts-as-ferret-tutorial"> acts_as_ferret  </a>老是無法套中文，後來看到<a href="http://lukhnos.org/blog/zh/archives/501">燈哥寫了中文斷詞法</a>，心中躍躍欲試，不過最後還是因為靈異原因沒有辦法斷……囧。所以我每次遇到這個問題能閃就閃。<br /><br />這次真的閃不掉了，於是我又繼續研究，當然還是遇到同樣的問題，問了 msn 上的朋友，沒有人有解（不是一樣被卡住，就是用斷詞器用的好好的從來沒有問題）。不過今天突然靈機一動，抓到問題 在哪....<br /><br />--- 以下是關鍵的地方 ---<br /><br />基本上因為 rails 對 utf-8 不太友善，所以寫中文 rails 網站，我們都會按照 google 來的方法，在 application.rb 上加上<br /><blockquote>  before_filter :configure_charsets<br /><br />  def configure_charsets<br />    @response.headers["Content-Type"] = "text/html; charset=utf-8"<br /><br />suppress(ActiveRecord::StatementInvalid) do<br />      ActiveRecord::Base.connection.execute 'SET NAMES UTF8'<br />    end<br /><br />end<br /></blockquote><br />然後將 database 的連線校對設為&nbsp;<dfn title="統一碼 (Unicode) (多語言), 大小寫不相符">utf8_unicode_ci，</dfn>確保畫面不會給你噴亂碼，一般來說這樣就夠了。所以設 database.yml 時，encoding : utf8 有加沒加根本是沒差的。<br /><br />問題來了....<br /><br />我就是一個沒有加的懶人（PS. 筆者從來也不知道寫了那幾行後，不加 encoding : utf8會有什麼後果），然後....用&nbsp;acts_as_ferret 斷詞時，就...噴了...。因為斷詞器是去掃瞄所有 db 裡的字，charset 錯誤自然就斷不到，自然中文就不會 index到...。就是這一個懶惰誤了我大半年的光陰，而且我還困擾到把所有在 google 上相關的 ferret 網頁通通看過一遍，最後還是沒找到解答。今天發現這個大關鍵，還是靈機一動想到的……（靈感啊，你怎麼來的這麼遲啊……）<br /><br />anyway，記述一下這件事情，希望以後跟我一樣懶的人遇到這件事情的時候有解，不要浪費冤枉路 XD<br /><br /><br />順便昭告一下 <a href="http://g.veryxd.net">VeryXD</a> 現在有搜尋功能了。<big><big><b>直排字橫排字都能搜喔</b></big></big>。<br /><br />---<br /><br />你搜尋的字是 "二嫂"，系統內共有 7 筆相關資料。<br /><br /><a href="http://g.veryxd.net/gphotos/6167bb9232d0ce6c63175ff6cacfb111" target="_blank"><img src="http://photog.veryxd.net/gphotos/0000/1874/4e919005f9ab680605996f1e6ae7a390.gif" border="0" /></a><br /><br /> 你搜尋的字是 "跳海"，系統內共有 29 筆相關資料<br /><br /><a href="http://g.veryxd.net/gphotos/db762f6ed6039332fdd83e831ec23036" target="_blank"><img src="http://photog.veryxd.net/gphotos/0000/2957/f30f4fc508b6ad8c2fc32b2c07159aab.gif" border="0" /></a><br /><br /><br /><br />爽....<br /><br />
